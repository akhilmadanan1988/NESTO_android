<!DOCTYPE html>
<html>
<head>
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1.0,user-scalable=no">
    <meta http-equiv="cashe-control" content="no-cashe">
    <link rel="stylesheet" href="css/jquery.mobile-1.4.2.min.css" />
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/main.css" />
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>

    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="js/jsEvents.js"></script>
    <script src="js/jquery.mobile-1.4.2.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>

<!--    <script type="text/javascript" src="PushNotification.js"></script>-->
    <script src="js/ajaxCall.js"></script>
    <script src="js/notification.js"></script>


    <script src="js/login.js"></script>

    <script type="text/javascript" charset="utf-8">
        $(document).bind("pagebeforechange", function (event, data) {
			if (localStorage != null) {
                if (localStorage.CardNumber != '' && localStorage.StorePassword != '' && localStorage.CardNumber != undefined && localStorage.StorePassword != undefined) {
//                    var docHeight = $('#home').height();
//					(".ui-loader").height(docHeight);
//                    $.mobile.loading('show', { theme: 'a',text: "",textonly: false, textVisible: false });
//					
                    var reqData = { "CardNumber": "" + localStorage.CardNumber + "", "DeviceId": "Android", "Password": "" + localStorage.StorePassword + "" }
                    ajaxcall("AuthenticateUserAndFetchPointDetails", reqData, IsLoginResponseSuccess, errorfunction);
                    event.preventDefault();
                    return false;
                }
            }
        });

        $(document).bind("pageshow", function (event, data) {
            if (localStorage != null) {
                if (localStorage.CardNumber == '' || localStorage.CardNumber == undefined) {
                    //checkConnection();
                    localStorage.DeviceType = 1;
                    var reqData = { "AppType": "" + localStorage.DeviceType + "", "DeviceId": "" + localStorage.DeviceId + "", "IPAddress": "", "UserId": "" + 0 + "" }
                    ajaxcall("UpdateUserDetailsAndFetchDefaultCountry", reqData, DataFetchedInIndex, errorfunction);
                }
            }
        });
		
        /*$(document).ready(function () {
            //alert(localStorage);
            //alert(localStorage.CardNumber);

            if (localStorage != null) {
                if (localStorage.CardNumber != '' && localStorage.StorePassword != '' && localStorage.CardNumber != undefined && localStorage.StorePassword != undefined) {
                    var reqData = { "CardNumber": "" + localStorage.CardNumber + "", "DeviceId": "Android", "Password": "" + localStorage.StorePassword + "" }
                    ajaxcall("AuthenticateUserAndFetchPointDetails", reqData, IsLoginResponseSuccess, errorfunction);
                    //window.location = "pointDetails.html";
                }
                else {
                    //checkConnection();
                    localStorage.DeviceType = 1;
                    var reqData = { "AppType": "" + localStorage.DeviceType + "", "DeviceId": "" + localStorage.DeviceId + "", "IPAddress": "", "UserId": "" + 0 + "" }
                    ajaxcall("UpdateUserDetailsAndFetchDefaultCountry", reqData, DataFetchedInIndex, errorfunction);
                }
            }
        });*/

        Storage.prototype.setArray = function (key, obj) {
            return this.setItem(key, JSON.stringify(obj))
        }
        Storage.prototype.getArray = function (key) {
            return JSON.parse(this.getItem(key))
        }

        function DataFetchedInIndex(result) {
            if (result.ApiResponse.StatusCode == 1) {
                if (result.PromotionList != null) {
                    if (result.PromotionList[0] != null)
                        localStorage.PromotionImage1 = result.PromotionList[0].PromotionThumbnail;

                    if (result.PromotionList[1] != null)
                        localStorage.PromotionImage2 = result.PromotionList[1].PromotionThumbnail;
                }

                if (result.UserDetail != null) {
                    if (localStorage.CountryID == undefined || localStorage.CountryID == null || localStorage.CountryID == "") {
                        localStorage.CountryID = result.UserDetail.CountryID;
                        localStorage.CountryName = result.UserDetail.CountryName;
						
						//Promotion and settings handling
						localStorage.SettingsCountryId = result.UserDetail.CountryID;
						localStorage.SettingsCountryName = result.UserDetail.CountryName;
						localStorage.PromoCountryId = result.UserDetail.CountryID;
						localStorage.PromoCountryName = result.UserDetail.CountryName;
                    }
                }
               
                if (result.PageNavigationUrls != null) {

                    $.each(result.PageNavigationUrls, function (index, value) {

                        if (value.UniqueName.trim() == "about") {
                            localStorage.AboutURl = value.SeoUrl;
                        }
                        else if (value.UniqueName == "terms") {
                            localStorage.TermsURl = value.SeoUrl;
                        }
                        else if (value.UniqueName == "faq") {
                            localStorage.FAQURl = value.SeoUrl;
                        }
                        else if (value.UniqueName == "special") {
                            localStorage.SpecialRewardsURl = value.SeoUrl;
                        }
                        else if (value.UniqueName == "Stores") {
                            localStorage.StoreDetailsURl = value.SeoUrl;
                        }

                    });

                }
                if (result.ServiceAvailableCountres != null) {
                    var ServiceAvailableCountries = new Array();

                    $.each(result.ServiceAvailableCountres, function (index, value) {
                        ServiceAvailableCountries.push({ CountryId: value.CountryId, CountryName: value.CountryName, IsDefault: value.IsDefault, ShortName: value.ShortName });
                        //if (value.IsDefault == true) {
                        //    localStorage.CountryID = value.CountryId;
                        //}
                    });
                    //     alert(localStorage.CountryID);
                    window.localStorage.setArray("ServiceAvailableCountries", ServiceAvailableCountries);
                    // var ServiceAvailableCountries = window.localStorage.getArray("ServiceAvailableCountries");


                }


                if (result.PushNotifyStatus != null) {
                    localStorage.DeviceId = result.PushNotifyStatus.DeviceId;
                    localStorage.IsStatusEnabled = result.PushNotifyStatus.IsStatusEnabled;
                }

            }

            $('#imgPromotionImage1').attr('src', localStorage.PromotionImage1);
            $('#imgPromotionImage2').attr('src', localStorage.PromotionImage2);

            localStorage.version = "V 1.0.0";

            navigator.splashscreen.hide();

            document.addEventListener("backbutton", onBackKeyDown, false);
        }

        function errorfunction() {
            navigator.splashscreen.hide();
        }

        function checkConnection() {

            var networkState = navigator.network.connection.type;

            var states = {};
            states[Connection.UNKNOWN] = 'Unknown connection';
            states[Connection.ETHERNET] = 'Ethernet connection';
            states[Connection.WIFI] = 'WiFi connection';
            states[Connection.CELL_2G] = 'Cell 2G connection';
            states[Connection.CELL_3G] = 'Cell 3G connection';
            states[Connection.CELL_4G] = 'Cell 4G connection';
            states[Connection.CELL] = 'Cell generic connection';
            states[Connection.NONE] = 'No network connection';

            if (states[networkState] == 'No network connection') {

                navigator.notification.confirm(
                          'No Internet Connection. Please connect the internet and relaunch the application.',
                          onConfirmQuit,
                          'No Internet Connection',
                          'OK,Cancel'
                      );
            }

        }

		function onConfirmQuit(button) {
            if (button == "1") {
                navigator.app.exitApp();
            }

        }

        function onBackKeyDown() {

            var current_url = $.mobile.activePage[0].baseURI;
            //alert(current_url);

            if (current_url == "file:///android_asset/www/index.html") {
                // alert(current_url);

                navigator.notification.confirm
                          ('Are you sure ?',
                            onConfirmQuit,
                            'Quit?',
                            'OK,Cancel'
                              );

            }
            else {

                navigator.app.backHistory();

            }


        }

        function onConfirmQuit(button) {
            if (button == "1") {
                navigator.app.exitApp();
            }
        }


        //	navigator.splashscreen.hide();
        //   var db = window.openDatabase("nesto", "1.0", "Nesto DB", 1000000);
        //}        
        // Populate the database 
        // Transaction error callback
        //
        //function errorCB(tx, err) {
        //    alert("Error processing SQL: " + err);
        //}

        // Transaction success callback
        //
        //function successCB() {
        //    alert("success!");
        //}
    </script>

</head>
<body>
    <div data-role="page" id="home" class="ui-responsive-panel">
        <script src="js/jsEvents.js"></script>
        <div data-role="panel" id="leftpanel3" data-position="left" data-display="overlay"
            data-dismissible="true" data-theme="a">
            <img src="images/shadowLight.png" class="shadowHolder" />
            <a class="pull-left sliderIcon panelCloseIcon" data-rel="close">
                <img src="images/menu.png" width="37" /></a>
            <div class="navigationHolder"></div>
            <ul data-role="listview">
                <a onclick="CheckUserExistanceAndNavigate()" data-transition="slide">
                    <li class="activeLink"><span class="glyphicon glyphicon-home"></span>Home</li>
                </a><a onclick="NavigateToPromotion()" data-transition="slide">
                    <li><span class="glyphicon glyphicon-gift"></span>Promotions</li>
                </a><a href="#" data-transition="slide">
                    <li onclick="onStoreLocationsLoad()"><span class="glyphicon glyphicon-map-marker"></span>
                        Store Locations</li>
                    <!--<li><span class="glyphicon glyphicon-map-marker"></span>Store Locations</li>-->
                </a><a href="about.html" data-transition="slide">
                    <li><span class="glyphicon glyphicon-info-sign"></span>About Us</li>
                </a><a href="settings.html" data-transition="slide">
                    <li><span class="glyphicon glyphicon-cog"></span>Settings</li>
                </a>
            </ul>
        </div>
        <!-- /leftpanel3 -->
        <!-- /defaultpanel -->
        <div data-role="header" class="customHeader">
            <a href="#leftpanel3" class="pull-left sliderIcon">
                <img src="images/menu.png" /></a>
            <img src="images/logo.png" width="185" class="mobileCustomizeLogo" />
        </div>
        <div class="seperationBar">
            <h5>All that you need.</h5>
        </div>
        <div data-role="content" class="contentHolder">
            <div class="container">
                <div class="row mobilePad">
                    <div class="col-md-12 pageArea">
                        <h2>LOGIN</h2>
						<form>
                        <table class="table tableListing tableContent" style="margin-bottom: 0">
                            <tbody>
                                <tr>
                                    <td>
                                        <label for="textinput-fc" class="mobileLabel" style="position: relative; left: -4px;">MyNesto Card Number</label>
                                    </td>
                                    <td>
                                        <input type="text" name="text-basic" id="txtCardNumber" value=""></td>
                                </tr>

                                <tr>
                                    <td>
                                        <label for="textinput-fc" style="position: relative; left: -4px;">Password</label>
                                    </td>
                                    <td>
                                        <input type="password" name="text-basic" id="txtPassword" value=""></td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        <div id="LoginMessage" class="col-md-12 visibleRow" style="background-color: rgb(226, 110, 110); color: #fff; text-align: center; font-size: 13px; padding: 4px; display: none;">
                                        </div>
                                    </td>
                                </tr>
                                <td>
                                    <label for="text-basic">
                                        <a href="forgetPwd.html" class="link" data-transition="slide" onclick="hideLabel()"
                                            style="font-size: 12px; position: relative; left: -4px;">Forgot Password</a></label>
                                </td>
                                <td class="loginAreaButton" nowrap="nowrap">
									<a  data-transition="slide" onclick="login()">
										<button type="submit" class="ui-btn ui-btn-inline pad5 logBut">Login</button>
									</a> 
									<a href="activateAccount.html" data-transition="slide">
                                        <button class="ui-btn ui-btn-inline pad5 activateBut">Activate Account</button>
                                    </a>
                                </td>
                                </tr>
                      
                            </tbody>
                        </table>
					</form>
                    </div>
                </div>
                <!--end row-->
                <div class="row mobilePad topPad0">
                    <div class="col-md-12 pageArea">
                        <h2 style="margin-bottom: 0">PROMOTIONS</h2>
                        <div class="ui-grid-a">
                            <div class="ui-block-a alignCenter" style="padding-right: 3px;">
                                <div class="ui-bar ui-bar-a promotionImgHolder">
                                    <a href="promotions.html" data-transition="slide">
                                        <img id="imgPromotionImage1" class="imgPromotionImage1" /></a>
                                </div>
                            </div>
                            <div class="ui-block-b alignCenter" style="padding-right: 3px; position: relative; left: 3px;">
                                <div class="ui-bar ui-bar-a promotionImgHolder">
                                    <a href="promotions.html" data-transition="slide">
                                        <img id="imgPromotionImage2" class="imgPromotionImage2" /></a>
                                </div>
                            </div>
                        </div>
                        <!-- /grid-a -->
                    </div>
                </div>
                <!--end row-->
            </div>
        </div>
<!--
	<script type="text/javascript" charset="utf-8" src="cordova.js"></script>

    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="js/jsEvents.js"></script>
    <script src="js/jquery.mobile-1.4.2.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>

    <script type="text/javascript" src="PushNotification.js"></script>
    <script src="js/ajaxCall.js"></script>
    <script src="js/notification.js"></script>


    <script src="js/login.js"></script>
-->
    </div>
    <script>
        //	$(window).bind("pageshow", function() {
        //    $('#txtPassword').val("");
        //		$('#txtCardNumber').val("");
        //		$('#LoginMessage').css('display', 'none');
        //	});

    </script>

</body>
</html>
